<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasah Admin Panel</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #F5F5DC 0%, #E8F5E8 100%);
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            transform: translateX(0);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .sidebar.collapsed {
            transform: translateX(-280px);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .sidebar-header h2 {
            color: white;
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .sidebar-header p {
            color: rgba(255,255,255,0.8);
            font-size: 0.875rem;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #4CAF50;
            color: white;
        }

        .menu-item i {
            margin-right: 1rem;
            font-size: 1.25rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .top-bar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #2E7D32;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .menu-toggle:hover {
            background: rgba(46, 125, 50, 0.1);
        }

        .content-area {
            padding: 2rem;
        }

        .page-title {
            color: #2E7D32;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
        }

        .page-title i {
            margin-right: 1rem;
            font-size: 2.25rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #E0E0E0;
            display: flex;
            align-items: center;
            justify-content: between;
        }

        .card-header h3 {
            color: #2E7D32;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .card-header i {
            margin-right: 0.75rem;
            color: #4CAF50;
        }

        .card-body {
            padding: 2rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(25, 118, 210, 0.3);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-card.green {
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            box-shadow: 0 4px 20px rgba(46, 125, 50, 0.3);
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #F57C00 0%, #E65100 100%);
            box-shadow: 0 4px 20px rgba(245, 124, 0, 0.3);
        }

        .stat-card.purple {
            background: linear-gradient(135deg, #7B1FA2 0%, #4A148C 100%);
            box-shadow: 0 4px 20px rgba(123, 31, 162, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
        }

        .stat-label i {
            margin-right: 0.5rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2E7D32;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #2E7D32;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
        }

        /* Table */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #E0E0E0;
        }

        th {
            background: #F5F5F5;
            color: #2E7D32;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(46, 125, 50, 0.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-280px);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-area {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Hidden sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Madrasah Admin</h2>
            <p>Management Panel</p>
        </div>
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active" onclick="showSection('dashboard')">
                <i class="material-icons">dashboard</i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('years')">
                <i class="material-icons">date_range</i>
                <span>Years</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('classes')">
                <i class="material-icons">school</i>
                <span>Classes</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('sections')">
                <i class="material-icons">group_work</i>
                <span>Sections</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('students')">
                <i class="material-icons">people</i>
                <span>Students</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('results')">
                <i class="material-icons">assessment</i>
                <span>Results</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('banners')">
                <i class="material-icons">banner</i>
                <span>Banners</span>
            </a>
        </nav>
    </div>

    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="material-icons">menu</i>
            </button>
            <h1 style="color: #2E7D32; font-weight: 600;">Madrasah Management System</h1>
        </div>

        <div class="content-area">
            <!-- Dashboard Section -->
            <div class="section active fade-in" id="dashboard">
                <div class="page-title">
                    <i class="material-icons">dashboard</i>
                    Dashboard
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">
                            <i class="material-icons">people</i>
                            Total Students
                        </div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-number" id="totalClasses">0</div>
                        <div class="stat-label">
                            <i class="material-icons">school</i>
                            Classes
                        </div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-number" id="totalResults">0</div>
                        <div class="stat-label">
                            <i class="material-icons">assessment</i>
                            Results
                        </div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-number" id="totalBanners">0</div>
                        <div class="stat-label">
                            <i class="material-icons">banner</i>
                            Banners
                        </div>
                    </div>
                </div>
            </div>

            <!-- Years Section -->
            <div class="section" id="years">
                <div class="page-title">
                    <i class="material-icons">date_range</i>
                    Manage Years
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">add</i>Add New Year</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Year</label>
                            <input type="text" class="form-control" id="yearInput" placeholder="e.g., 2024">
                        </div>
                        <button class="btn btn-primary" onclick="addYear()">
                            <i class="material-icons">add</i>Add Year
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">list</i>Years List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="yearsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Classes Section -->
            <div class="section" id="classes">
                <div class="page-title">
                    <i class="material-icons">school</i>
                    Manage Classes
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">add</i>Add New Class</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Class Name</label>
                            <input type="text" class="form-control" id="classInput" placeholder="e.g., Class 10">
                        </div>
                        <button class="btn btn-primary" onclick="addClass()">
                            <i class="material-icons">add</i>Add Class
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">list</i>Classes List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Class Name</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classesList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sections Section -->
            <div class="section" id="sections">
                <div class="page-title">
                    <i class="material-icons">group_work</i>
                    Manage Sections
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">add</i>Add New Section</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Section Name</label>
                            <input type="text" class="form-control" id="sectionInput" placeholder="e.g., A, B, C">
                        </div>
                        <button class="btn btn-primary" onclick="addSection()">
                            <i class="material-icons">add</i>Add Section
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">list</i>Sections List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Section Name</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sectionsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Section -->
            <div class="section" id="students">
                <div class="page-title">
                    <i class="material-icons">people</i>
                    Manage Students
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">person_add</i>Add New Student</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label>Student Name</label>
                                <input type="text" class="form-control" id="studentName" placeholder="Enter student name">
                            </div>
                            <div class="form-group">
                                <label>Class</label>
                                <select class="form-control" id="studentClass"></select>
                            </div>
                            <div class="form-group">
                                <label>Year</label>
                                <select class="form-control" id="studentYear"></select>
                            </div>
                            <div class="form-group">
                                <label>Section</label>
                                <select class="form-control" id="studentSection"></select>
                            </div>
                            <div class="form-group">
                                <label>Roll Number</label>
                                <input type="text" class="form-control" id="studentRoll" placeholder="Enter roll number">
                            </div>
                            <div class="form-group">
                                <label>User ID (Optional)</label>
                                <input type="text" class="form-control" id="studentUserId" placeholder="Enter user ID">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addStudent()">
                            <i class="material-icons">person_add</i>Add Student
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">people</i>Students List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Class</th>
                                        <th>Year</th>
                                        <th>Section</th>
                                        <th>Roll</th>
                                        <th>User ID</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="section" id="results">
                <div class="page-title">
                    <i class="material-icons">assessment</i>
                    Manage Results
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">add</i>Add New Result</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label>Student</label>
                                <select class="form-control" id="resultStudent"></select>
                            </div>
                            <div class="form-group">
                                <label>Class</label>
                                <select class="form-control" id="resultClass"></select>
                            </div>
                            <div class="form-group">
                                <label>Result Link</label>
                                <input type="url" class="form-control" id="resultLink" placeholder="Enter result link (PDF/Google Drive)">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addResult()">
                            <i class="material-icons">add</i>Add Result
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">assessment</i>Results List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Class</th>
                                        <th>Result Link</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Banners Section -->
            <div class="section" id="banners">
                <div class="page-title">
                    <i class="material-icons">banner</i>
                    Manage Banners
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="material-icons">add</i>Add New Banner</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label>Banner Title</label>
                                <input type="text" class="form-control" id="bannerTitle" placeholder="Enter banner title">
                            </div>
                            <div class="form-group">
                                <label>Link (Optional)</label>
                                <input type="url" class="form-control" id="bannerLink" placeholder="Enter link (optional)">
                            </div>
                            <div class="form-group">
                                <label>Icon/Image URL (Optional)</label>
                                <input type="url" class="form-control" id="bannerIcon" placeholder="Enter icon/image URL (optional)">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addBanner()">
                            <i class="material-icons">add</i>Add Banner
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3><i class="material-icons">banner</i>Banners List</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Link</th>
                                        <th>Icon/Image</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bannersList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDXGVWLFDY2Jrk0Pjxz4XP0bCQVg0Iextc",
            authDomain: "queenschool-803d9.firebaseapp.com",
            databaseURL: "https://queenschool-803d9-default-rtdb.firebaseio.com",
            projectId: "queenschool-803d9",
            storageBucket: "queenschool-803d9.firebasestorage.app",
            messagingSenderId: "1078969444409",
            appId: "1:1078969444409:web:4eff0ec9ffe9b399cdc5e8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let yearsData = {};
        let classesData = {};
        let sectionsData = {};
        let studentsData = {};
        let resultsData = {};
        let bannersData = {};

        // Initialize app
        window.onload = function() {
            loadAllData();
        };

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const overlay = document.getElementById('overlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }

        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked menu item
            event.target.classList.add('active');
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            // Load specific data based on section
            switch(sectionId) {
                case 'students':
                    populateStudentDropdowns();
                    break;
                case 'results':
                    populateResultDropdowns();
                    break;
            }
        }

        // Load all data from Firebase
        function loadAllData() {
            database.ref('/').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                
                yearsData = data.years || {};
                classesData = data.classes || {};
                sectionsData = data.sections || {};
                studentsData = data.students || {};
                resultsData = data.results || {};
                bannersData = data.banners || {};
                
                updateDashboard();
                displayYears();
                displayClasses();
                displaySections();
                displayStudents();
                displayResults();
                displayBanners();
            });
        }

        // Update dashboard stats
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = Object.keys(studentsData).length;
            document.getElementById('totalClasses').textContent = Object.keys(classesData).length;
            document.getElementById('totalResults').textContent = Object.keys(resultsData).length;
            document.getElementById('totalBanners').textContent = Object.keys(bannersData).length;
        }

        // Years functions
        function addYear() {
            const yearInput = document.getElementById('yearInput');
            const year = yearInput.value.trim();
            
            if (year) {
                const yearId = Date.now().toString();
                database.ref('years/' + yearId).set({
                    year: year
                }).then(() => {
                    yearInput.value = '';
                    alert('Year added successfully!');
                }).catch((error) => {
                    alert('Error adding year: ' + error.message);
                });
            } else {
                alert('Please enter a year');
            }
        }

        function displayYears() {
            const yearsList = document.getElementById('yearsList');
            yearsList.innerHTML = '';
            
            Object.entries(yearsData).forEach(([id, data]) => {
                yearsList.innerHTML += `
                    <tr>
                        <td>${data.year}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteYear('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteYear(id) {
            if (confirm('Are you sure you want to delete this year?')) {
                database.ref('years/' + id).remove().then(() => {
                    alert('Year deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting year: ' + error.message);
                });
            }
        }

        // Classes functions
        function addClass() {
            const classInput = document.getElementById('classInput');
            const className = classInput.value.trim();
            
            if (className) {
                const classId = Date.now().toString();
                database.ref('classes/' + classId).set({
                    name: className
                }).then(() => {
                    classInput.value = '';
                    alert('Class added successfully!');
                }).catch((error) => {
                    alert('Error adding class: ' + error.message);
                });
            } else {
                alert('Please enter a class name');
            }
        }

        function displayClasses() {
            const classesList = document.getElementById('classesList');
            classesList.innerHTML = '';
            
            Object.entries(classesData).forEach(([id, data]) => {
                classesList.innerHTML += `
                    <tr>
                        <td>${data.name}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteClass('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteClass(id) {
            if (confirm('Are you sure you want to delete this class?')) {
                database.ref('classes/' + id).remove().then(() => {
                    alert('Class deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting class: ' + error.message);
                });
            }
        }

        // Sections functions
        function addSection() {
            const sectionInput = document.getElementById('sectionInput');
            const sectionName = sectionInput.value.trim();
            
            if (sectionName) {
                const sectionId = Date.now().toString();
                database.ref('sections/' + sectionId).set({
                    name: sectionName
                }).then(() => {
                    sectionInput.value = '';
                    alert('Section added successfully!');
                }).catch((error) => {
                    alert('Error adding section: ' + error.message);
                });
            } else {
                alert('Please enter a section name');
            }
        }

        function displaySections() {
            const sectionsList = document.getElementById('sectionsList');
            sectionsList.innerHTML = '';
            
            Object.entries(sectionsData).forEach(([id, data]) => {
                sectionsList.innerHTML += `
                    <tr>
                        <td>${data.name}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteSection('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteSection(id) {
            if (confirm('Are you sure you want to delete this section?')) {
                database.ref('sections/' + id).remove().then(() => {
                    alert('Section deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting section: ' + error.message);
                });
            }
        }

        // Students functions
        function populateStudentDropdowns() {
            const classSelect = document.getElementById('studentClass');
            const yearSelect = document.getElementById('studentYear');
            const sectionSelect = document.getElementById('studentSection');
            
            // Populate classes
            classSelect.innerHTML = '<option value="">Select Class</option>';
            Object.entries(classesData).forEach(([id, data]) => {
                classSelect.innerHTML += `<option value="${id}">${data.name}</option>`;
            });
            
            // Populate years
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            Object.entries(yearsData).forEach(([id, data]) => {
                yearSelect.innerHTML += `<option value="${id}">${data.year}</option>`;
            });
            
            // Populate sections
            sectionSelect.innerHTML = '<option value="">Select Section</option>';
            Object.entries(sectionsData).forEach(([id, data]) => {
                sectionSelect.innerHTML += `<option value="${id}">${data.name}</option>`;
            });
        }

        function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const classId = document.getElementById('studentClass').value;
            const yearId = document.getElementById('studentYear').value;
            const sectionId = document.getElementById('studentSection').value;
            const roll = document.getElementById('studentRoll').value.trim();
            const userId = document.getElementById('studentUserId').value.trim();
            
            if (name && classId && yearId && sectionId && roll) {
                const studentId = Date.now().toString();
                database.ref('students/' + studentId).set({
                    name: name,
                    classId: classId,
                    yearId: yearId,
                    sectionId: sectionId,
                    roll: roll,
                    userId: userId || ''
                }).then(() => {
                    // Clear form
                    document.getElementById('studentName').value = '';
                    document.getElementById('studentClass').value = '';
                    document.getElementById('studentYear').value = '';
                    document.getElementById('studentSection').value = '';
                    document.getElementById('studentRoll').value = '';
                    document.getElementById('studentUserId').value = '';
                    alert('Student added successfully!');
                }).catch((error) => {
                    alert('Error adding student: ' + error.message);
                });
            } else {
                alert('Please fill in all required fields');
            }
        }

        function displayStudents() {
            const studentsList = document.getElementById('studentsList');
            studentsList.innerHTML = '';
            
            Object.entries(studentsData).forEach(([id, student]) => {
                const className = classesData[student.classId]?.name || 'Unknown';
                const year = yearsData[student.yearId]?.year || 'Unknown';
                const section = sectionsData[student.sectionId]?.name || 'Unknown';
                
                studentsList.innerHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${className}</td>
                        <td>${year}</td>
                        <td>${section}</td>
                        <td>${student.roll}</td>
                        <td>${student.userId || '-'}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteStudent('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                database.ref('students/' + id).remove().then(() => {
                    alert('Student deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting student: ' + error.message);
                });
            }
        }

        // Results functions
        function populateResultDropdowns() {
            const studentSelect = document.getElementById('resultStudent');
            const classSelect = document.getElementById('resultClass');
            
            // Populate students
            studentSelect.innerHTML = '<option value="">Select Student</option>';
            Object.entries(studentsData).forEach(([id, student]) => {
                studentSelect.innerHTML += `<option value="${id}">${student.name} (Roll: ${student.roll})</option>`;
            });
            
            // Populate classes
            classSelect.innerHTML = '<option value="">Select Class</option>';
            Object.entries(classesData).forEach(([id, data]) => {
                classSelect.innerHTML += `<option value="${id}">${data.name}</option>`;
            });
        }

        function addResult() {
            const studentId = document.getElementById('resultStudent').value;
            const classId = document.getElementById('resultClass').value;
            const link = document.getElementById('resultLink').value.trim();
            
            if (studentId && classId && link) {
                const resultId = Date.now().toString();
                database.ref('results/' + resultId).set({
                    studentId: studentId,
                    classId: classId,
                    link: link
                }).then(() => {
                    // Clear form
                    document.getElementById('resultStudent').value = '';
                    document.getElementById('resultClass').value = '';
                    document.getElementById('resultLink').value = '';
                    alert('Result added successfully!');
                }).catch((error) => {
                    alert('Error adding result: ' + error.message);
                });
            } else {
                alert('Please fill in all fields');
            }
        }

        function displayResults() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            Object.entries(resultsData).forEach(([id, result]) => {
                const student = studentsData[result.studentId];
                const className = classesData[result.classId]?.name || 'Unknown';
                const studentName = student ? `${student.name} (Roll: ${student.roll})` : 'Unknown';
                
                resultsList.innerHTML += `
                    <tr>
                        <td>${studentName}</td>
                        <td>${className}</td>
                        <td><a href="${result.link}" target="_blank">View Result</a></td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteResult('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteResult(id) {
            if (confirm('Are you sure you want to delete this result?')) {
                database.ref('results/' + id).remove().then(() => {
                    alert('Result deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting result: ' + error.message);
                });
            }
        }

        // Banners functions
        function addBanner() {
            const title = document.getElementById('bannerTitle').value.trim();
            const link = document.getElementById('bannerLink').value.trim();
            const icon = document.getElementById('bannerIcon').value.trim();
            
            if (title) {
                const bannerId = Date.now().toString();
                database.ref('banners/' + bannerId).set({
                    title: title,
                    link: link || '',
                    icon: icon || ''
                }).then(() => {
                    // Clear form
                    document.getElementById('bannerTitle').value = '';
                    document.getElementById('bannerLink').value = '';
                    document.getElementById('bannerIcon').value = '';
                    alert('Banner added successfully!');
                }).catch((error) => {
                    alert('Error adding banner: ' + error.message);
                });
            } else {
                alert('Please enter a banner title');
            }
        }

        function displayBanners() {
            const bannersList = document.getElementById('bannersList');
            bannersList.innerHTML = '';
            
            Object.entries(bannersData).forEach(([id, banner]) => {
                bannersList.innerHTML += `
                    <tr>
                        <td>${banner.title}</td>
                        <td>${banner.link ? `<a href="${banner.link}" target="_blank">View Link</a>` : '-'}</td>
                        <td>${banner.icon ? `<img src="${banner.icon}" style="width: 50px; height: 50px; object-fit: cover;" alt="Banner Icon">` : '-'}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteBanner('${id}')">
                                <i class="material-icons">delete</i>Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteBanner(id) {
            if (confirm('Are you sure you want to delete this banner?')) {
                database.ref('banners/' + id).remove().then(() => {
                    alert('Banner deleted successfully!');
                }).catch((error) => {
                    alert('Error deleting banner: ' + error.message);
                });
            }
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target) && 
                sidebar.classList.contains('open')) {
                toggleSidebar();
            }
        });
    </script>
</body>
</html>
