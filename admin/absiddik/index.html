<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasah Admin Panel</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar.collapsed .sidebar-header h2 {
            display: none;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar-menu a:hover {
            background: rgba(255,255,255,0.1);
            padding-left: 30px;
        }

        .sidebar-menu a.active {
            background: rgba(255,255,255,0.2);
            border-right: 4px solid #4caf50;
        }

        .sidebar-menu i {
            margin-right: 15px;
            width: 24px;
        }

        .sidebar.collapsed .sidebar-menu span {
            display: none;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        .top-bar {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #2e7d32;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
        }

        .stat-card h3 {
            color: #2e7d32;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-weight: 500;
        }

        .stat-card i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
            color: rgba(76, 175, 80, 0.1);
        }

        .content-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: #2e7d32;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #4caf50;
            outline: none;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.1);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2e7d32;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .data-card:hover {
            border-color: #4caf50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
        }

        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .data-card-title {
            font-weight: 600;
            color: #2e7d32;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #f44336;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                position: fixed;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <i class="material-icons">school</i>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="menu-item active"><i class="material-icons">dashboard</i><span>Dashboard</span></a></li>
                <li><a href="#years" class="menu-item"><i class="material-icons">date_range</i><span>Years</span></a></li>
                <li><a href="#classes" class="menu-item"><i class="material-icons">class</i><span>Classes</span></a></li>
                <li><a href="#sections" class="menu-item"><i class="material-icons">view_module</i><span>Sections</span></a></li>
                <li><a href="#students" class="menu-item"><i class="material-icons">people</i><span>Students</span></a></li>
                <li><a href="#results" class="menu-item"><i class="material-icons">assignment</i><span>Results</span></a></li>
                <li><a href="#banners" class="menu-item"><i class="material-icons">image</i><span>Banners</span></a></li>
                <li><a href="#notices" class="menu-item"><i class="material-icons">announcement</i><span>Notices</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="menu-toggle" id="menuToggle">
                    <i class="material-icons">menu</i>
                </button>
                <h1>Madrasah Management System</h1>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard">
                <div class="section-header">
                    <h2><i class="material-icons">dashboard</i> Dashboard</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalStudents">0</h3>
                        <p>Total Students</p>
                        <i class="material-icons">people</i>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalClasses">0</h3>
                        <p>Total Classes</p>
                        <i class="material-icons">class</i>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalSections">0</h3>
                        <p>Total Sections</p>
                        <i class="material-icons">view_module</i>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalResults">0</h3>
                        <p>Total Results</p>
                        <i class="material-icons">assignment</i>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalBanners">0</h3>
                        <p>Total Banners</p>
                        <i class="material-icons">image</i>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalNotices">0</h3>
                        <p>Total Notices</p>
                        <i class="material-icons">announcement</i>
                    </div>
                </div>
            </div>

            <!-- Years Section -->
            <div class="content-section" id="years">
                <div class="section-header">
                    <h2><i class="material-icons">date_range</i> Academic Years</h2>
                    <button class="btn btn-primary" onclick="openModal('yearModal')">
                        <i class="material-icons">add</i> Add Year
                    </button>
                </div>
                <div id="yearsList"></div>
            </div>

            <!-- Classes Section -->
            <div class="content-section" id="classes">
                <div class="section-header">
                    <h2><i class="material-icons">class</i> Classes</h2>
                    <button class="btn btn-primary" onclick="openModal('classModal')">
                        <i class="material-icons">add</i> Add Class
                    </button>
                </div>
                <div id="classesList"></div>
            </div>

            <!-- Sections Section -->
            <div class="content-section" id="sections">
                <div class="section-header">
                    <h2><i class="material-icons">view_module</i> Sections</h2>
                    <button class="btn btn-primary" onclick="openModal('sectionModal')">
                        <i class="material-icons">add</i> Add Section
                    </button>
                </div>
                <div id="sectionsList"></div>
            </div>

            <!-- Students Section -->
            <div class="content-section" id="students">
                <div class="section-header">
                    <h2><i class="material-icons">people</i> Students</h2>
                    <button class="btn btn-primary" onclick="openModal('studentModal')">
                        <i class="material-icons">add</i> Add Student
                    </button>
                </div>
                <div id="studentsList"></div>
            </div>

            <!-- Results Section -->
            <div class="content-section" id="results">
                <div class="section-header">
                    <h2><i class="material-icons">assignment</i> Results</h2>
                    <button class="btn btn-primary" onclick="openModal('resultModal')">
                        <i class="material-icons">add</i> Add Result
                    </button>
                </div>
                <div id="resultsList"></div>
            </div>

            <!-- Banners Section -->
            <div class="content-section" id="banners">
                <div class="section-header">
                    <h2><i class="material-icons">image</i> Banners</h2>
                    <button class="btn btn-primary" onclick="openModal('bannerModal')">
                        <i class="material-icons">add</i> Add Banner
                    </button>
                </div>
                <div id="bannersList"></div>
            </div>

            <!-- Notices Section -->
            <div class="content-section" id="notices">
                <div class="section-header">
                    <h2><i class="material-icons">announcement</i> Notices</h2>
                    <button class="btn btn-primary" onclick="openModal('noticeModal')">
                        <i class="material-icons">add</i> Add Notice
                    </button>
                </div>
                <div id="noticesList"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Year Modal -->
    <div id="yearModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('yearModal')">&times;</span>
            <h2>Add Academic Year</h2>
            <form id="yearForm">
                <div class="form-group">
                    <label>Year</label>
                    <input type="text" name="year" placeholder="e.g., 2024" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Year</button>
            </form>
        </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('classModal')">&times;</span>
            <h2>Add Class</h2>
            <form id="classForm">
                <div class="form-group">
                    <label>Class Name</label>
                    <input type="text" name="className" placeholder="e.g., Class 1, Class 2" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Class</button>
            </form>
        </div>
    </div>

    <!-- Section Modal -->
    <div id="sectionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sectionModal')">&times;</span>
            <h2>Add Section</h2>
            <form id="sectionForm">
                <div class="form-group">
                    <label>Section Name</label>
                    <input type="text" name="sectionName" placeholder="e.g., A, B, C" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Section</button>
            </form>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentModal')">&times;</span>
            <h2>Add Student</h2>
            <form id="studentForm">
                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" name="name" placeholder="Student Full Name" required>
                </div>
                <div class="form-group">
                    <label>Class</label>
                    <select name="className" id="studentClass" required>
                        <option value="">Select Class</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <select name="year" id="studentYear" required>
                        <option value="">Select Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Section</label>
                    <select name="section" id="studentSection" required>
                        <option value="">Select Section</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Roll Number</label>
                    <input type="number" name="roll" placeholder="Roll Number" required>
                </div>
                <div class="form-group">
                    <label>User ID (Optional)</label>
                    <input type="text" name="userId" placeholder="Optional User ID">
                </div>
                <button type="submit" class="btn btn-primary">Add Student</button>
            </form>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('resultModal')">&times;</span>
            <h2>Add Result</h2>
            <form id="resultForm">
                <div class="form-group">
                    <label>Student</label>
                    <select name="studentId" id="resultStudent" required>
                        <option value="">Select Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Class</label>
                    <select name="className" id="resultClass" required>
                        <option value="">Select Class</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Result Link</label>
                    <input type="url" name="resultLink" placeholder="PDF or Google Drive Link" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Result</button>
            </form>
        </div>
    </div>

    <!-- Banner Modal -->
    <div id="bannerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bannerModal')">&times;</span>
            <h2>Add Banner</h2>
            <form id="bannerForm">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" placeholder="Banner Title" required>
                </div>
                <div class="form-group">
                    <label>Link (Optional)</label>
                    <input type="url" name="link" placeholder="Banner Link (Optional)">
                </div>
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="url" name="imageUrl" placeholder="Full Width Image URL" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Banner</button>
            </form>
        </div>
    </div>

    <!-- Notice Modal -->
    <div id="noticeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('noticeModal')">&times;</span>
            <h2>Add Notice</h2>
            <form id="noticeForm">
                <div class="form-group">
                    <label>Notice Text</label>
                    <textarea name="text" rows="3" placeholder="Notice Text/Title" required></textarea>
                </div>
                <div class="form-group">
                    <label>URL (Optional)</label>
                    <input type="url" name="url" placeholder="Optional URL">
                </div>
                <button type="submit" class="btn btn-primary">Add Notice</button>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Alert -->
    <div id="alert" class="alert"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDXGVWLFDY2Jrk0Pjxz4XP0bCQVg0Iextc",
            authDomain: "queenschool-803d9.firebaseapp.com",
            databaseURL: "https://queenschool-803d9-default-rtdb.firebaseio.com",
            projectId: "queenschool-803d9",
            storageBucket: "queenschool-803d9.firebasestorage.app",
            messagingSenderId: "1078969444409",
            appId: "1:1078969444409:web:4eff0ec9ffe9b399cdc5e8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const menuToggle = document.getElementById('menuToggle');

        // Menu Toggle
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            sidebar.classList.toggle('mobile-open');
        });

        // Menu Items
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const target = item.getAttribute('href').substring(1);
                
                // Update active menu item
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                item.classList.add('active');

                // Show target section
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(target).classList.add('active');

                // Load data for the section
                loadSectionData(target);

                // Close mobile menu
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        });

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Show Alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // Show Loading
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Year Functions
        document.getElementById('yearForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const year = formData.get('year');

            showLoading();
            database.ref('years').push({
                year: year,
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Year added successfully!', 'success');
                closeModal('yearModal');
                e.target.reset();
                loadYears();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding year: ' + error.message, 'error');
            });
        });

        function loadYears() {
            const yearsList = document.getElementById('yearsList');
            database.ref('years').on('value', (snapshot) => {
                yearsList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        yearsList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">${data.year}</span>
                                    <button class="btn btn-danger" onclick="deleteYear('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteYear(key) {
            if (confirm('Are you sure you want to delete this year?')) {
                database.ref('years/' + key).remove().then(() => {
                    showAlert('Year deleted successfully!', 'success');
                });
            }
        }

        // Class Functions
        document.getElementById('classForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const className = formData.get('className');

            showLoading();
            database.ref('classes').push({
                className: className,
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Class added successfully!', 'success');
                closeModal('classModal');
                e.target.reset();
                loadClasses();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding class: ' + error.message, 'error');
            });
        });

        function loadClasses() {
            const classesList = document.getElementById('classesList');
            database.ref('classes').on('value', (snapshot) => {
                classesList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        classesList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">${data.className}</span>
                                    <button class="btn btn-danger" onclick="deleteClass('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteClass(key) {
            if (confirm('Are you sure you want to delete this class?')) {
                database.ref('classes/' + key).remove().then(() => {
                    showAlert('Class deleted successfully!', 'success');
                });
            }
        }

        // Section Functions
        document.getElementById('sectionForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const sectionName = formData.get('sectionName');

            showLoading();
            database.ref('sections').push({
                sectionName: sectionName,
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Section added successfully!', 'success');
                closeModal('sectionModal');
                e.target.reset();
                loadSections();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding section: ' + error.message, 'error');
            });
        });

        function loadSections() {
            const sectionsList = document.getElementById('sectionsList');
            database.ref('sections').on('value', (snapshot) => {
                sectionsList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        sectionsList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">Section ${data.sectionName}</span>
                                    <button class="btn btn-danger" onclick="deleteSection('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteSection(key) {
            if (confirm('Are you sure you want to delete this section?')) {
                database.ref('sections/' + key).remove().then(() => {
                    showAlert('Section deleted successfully!', 'success');
                });
            }
        }

        // Student Functions
        document.getElementById('studentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            showLoading();
            database.ref('students').push({
                name: formData.get('name'),
                className: formData.get('className'),
                year: formData.get('year'),
                section: formData.get('section'),
                roll: parseInt(formData.get('roll')),
                userId: formData.get('userId') || '',
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Student added successfully!', 'success');
                closeModal('studentModal');
                e.target.reset();
                loadStudents();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding student: ' + error.message, 'error');
            });
        });

        function loadStudents() {
            const studentsList = document.getElementById('studentsList');
            database.ref('students').on('value', (snapshot) => {
                studentsList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        studentsList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">${data.name}</span>
                                    <button class="btn btn-danger" onclick="deleteStudent('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                                <p><strong>Class:</strong> ${data.className}</p>
                                <p><strong>Year:</strong> ${data.year}</p>
                                <p><strong>Section:</strong> ${data.section}</p>
                                <p><strong>Roll:</strong> ${data.roll}</p>
                                ${data.userId ? `<p><strong>User ID:</strong> ${data.userId}</p>` : ''}
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteStudent(key) {
            if (confirm('Are you sure you want to delete this student?')) {
                database.ref('students/' + key).remove().then(() => {
                    showAlert('Student deleted successfully!', 'success');
                });
            }
        }

        // Result Functions
        document.getElementById('resultForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            showLoading();
            database.ref('results').push({
                studentId: formData.get('studentId'),
                className: formData.get('className'),
                resultLink: formData.get('resultLink'),
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Result added successfully!', 'success');
                closeModal('resultModal');
                e.target.reset();
                loadResults();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding result: ' + error.message, 'error');
            });
        });

        function loadResults() {
            const resultsList = document.getElementById('resultsList');
            database.ref('results').on('value', (snapshot) => {
                resultsList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        
                        // Get student name
                        database.ref('students/' + data.studentId).once('value', (studentSnapshot) => {
                            const student = studentSnapshot.val();
                            const studentName = student ? student.name : 'Unknown Student';
                            
                            resultsList.innerHTML += `
                                <div class="data-card">
                                    <div class="data-card-header">
                                        <span class="data-card-title">${studentName}</span>
                                        <button class="btn btn-danger" onclick="deleteResult('${key}')">
                                            <i class="material-icons">delete</i> Delete
                                        </button>
                                    </div>
                                    <p><strong>Class:</strong> ${data.className}</p>
                                    <p><strong>Result:</strong> <a href="${data.resultLink}" target="_blank">View Result</a></p>
                                </div>
                            `;
                        });
                    });
                }
            });
        }

        function deleteResult(key) {
            if (confirm('Are you sure you want to delete this result?')) {
                database.ref('results/' + key).remove().then(() => {
                    showAlert('Result deleted successfully!', 'success');
                });
            }
        }

        // Banner Functions
        document.getElementById('bannerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            showLoading();
            database.ref('banners').push({
                title: formData.get('title'),
                link: formData.get('link') || '',
                imageUrl: formData.get('imageUrl'),
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Banner added successfully!', 'success');
                closeModal('bannerModal');
                e.target.reset();
                loadBanners();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding banner: ' + error.message, 'error');
            });
        });

        function loadBanners() {
            const bannersList = document.getElementById('bannersList');
            database.ref('banners').on('value', (snapshot) => {
                bannersList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        bannersList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">${data.title}</span>
                                    <button class="btn btn-danger" onclick="deleteBanner('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                                <p><strong>Link:</strong> ${data.link || 'No link'}</p>
                                <p><strong>Image:</strong> <a href="${data.imageUrl}" target="_blank">View Image</a></p>
                                <img src="${data.imageUrl}" alt="${data.title}" style="width: 100%; max-width: 300px; height: auto; margin-top: 10px; border-radius: 8px;">
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteBanner(key) {
            if (confirm('Are you sure you want to delete this banner?')) {
                database.ref('banners/' + key).remove().then(() => {
                    showAlert('Banner deleted successfully!', 'success');
                });
            }
        }

        // Notice Functions
        document.getElementById('noticeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            showLoading();
            database.ref('notices').push({
                text: formData.get('text'),
                url: formData.get('url') || '',
                createdAt: Date.now()
            }).then(() => {
                hideLoading();
                showAlert('Notice added successfully!', 'success');
                closeModal('noticeModal');
                e.target.reset();
                loadNotices();
            }).catch((error) => {
                hideLoading();
                showAlert('Error adding notice: ' + error.message, 'error');
            });
        });

        function loadNotices() {
            const noticesList = document.getElementById('noticesList');
            database.ref('notices').on('value', (snapshot) => {
                noticesList.innerHTML = '';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        noticesList.innerHTML += `
                            <div class="data-card">
                                <div class="data-card-header">
                                    <span class="data-card-title">${data.text.substring(0, 50)}...</span>
                                    <button class="btn btn-danger" onclick="deleteNotice('${key}')">
                                        <i class="material-icons">delete</i> Delete
                                    </button>
                                </div>
                                <p><strong>Full Text:</strong> ${data.text}</p>
                                <p><strong>URL:</strong> ${data.url || 'No URL'}</p>
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteNotice(key) {
            if (confirm('Are you sure you want to delete this notice?')) {
                database.ref('notices/' + key).remove().then(() => {
                    showAlert('Notice deleted successfully!', 'success');
                });
            }
        }

        // Load dropdown data
        function loadDropdownData() {
            // Load classes for student form
            database.ref('classes').on('value', (snapshot) => {
                const classSelect = document.getElementById('studentClass');
                const resultClassSelect = document.getElementById('resultClass');
                classSelect.innerHTML = '<option value="">Select Class</option>';
                resultClassSelect.innerHTML = '<option value="">Select Class</option>';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        classSelect.innerHTML += `<option value="${data.className}">${data.className}</option>`;
                        resultClassSelect.innerHTML += `<option value="${data.className}">${data.className}</option>`;
                    });
                }
            });

            // Load years for student form
            database.ref('years').on('value', (snapshot) => {
                const yearSelect = document.getElementById('studentYear');
                yearSelect.innerHTML = '<option value="">Select Year</option>';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        yearSelect.innerHTML += `<option value="${data.year}">${data.year}</option>`;
                    });
                }
            });

            // Load sections for student form
            database.ref('sections').on('value', (snapshot) => {
                const sectionSelect = document.getElementById('studentSection');
                sectionSelect.innerHTML = '<option value="">Select Section</option>';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        sectionSelect.innerHTML += `<option value="${data.sectionName}">${data.sectionName}</option>`;
                    });
                }
            });

            // Load students for result form
            database.ref('students').on('value', (snapshot) => {
                const studentSelect = document.getElementById('resultStudent');
                studentSelect.innerHTML = '<option value="">Select Student</option>';
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const key = childSnapshot.key;
                        studentSelect.innerHTML += `<option value="${key}">${data.name} - ${data.className}</option>`;
                    });
                }
            });
        }

        // Load section data
        function loadSectionData(section) {
            switch(section) {
                case 'years':
                    loadYears();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'sections':
                    loadSections();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'results':
                    loadResults();
                    break;
                case 'banners':
                    loadBanners();
                    break;
                case 'notices':
                    loadNotices();
                    break;
                case 'dashboard':
                    loadDashboardStats();
                    break;
            }
        }

        // Load dashboard stats
        function loadDashboardStats() {
            database.ref('students').once('value', (snapshot) => {
                document.getElementById('totalStudents').textContent = snapshot.numChildren();
            });
            database.ref('classes').once('value', (snapshot) => {
                document.getElementById('totalClasses').textContent = snapshot.numChildren();
            });
            database.ref('sections').once('value', (snapshot) => {
                document.getElementById('totalSections').textContent = snapshot.numChildren();
            });
            database.ref('results').once('value', (snapshot) => {
                document.getElementById('totalResults').textContent = snapshot.numChildren();
            });
            database.ref('banners').once('value', (snapshot) => {
                document.getElementById('totalBanners').textContent = snapshot.numChildren();
            });
            database.ref('notices').once('value', (snapshot) => {
                document.getElementById('totalNotices').textContent = snapshot.numChildren();
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardStats();
            loadDropdownData();
        });
    </script>
</body>
</html>
