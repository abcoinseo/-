<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasah Admin Panel</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2E7D32;
            --secondary-color: #81C784;
            --accent-color: #4FC3F7;
            --cream-color: #FFF8E1;
            --light-green: #E8F5E8;
            --dark-green: #1B5E20;
            --text-primary: #2C3E50;
            --text-secondary: #7F8C8D;
            --white: #FFFFFF;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--cream-color) 0%, var(--light-green) 100%);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--dark-green) 100%);
            color: white;
            transform: translateX(0);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            transform: translateX(-280px);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: var(--accent-color);
        }

        .menu-item .material-icons {
            margin-right: 1rem;
            font-size: 1.3rem;
        }

        .menu-item span {
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .top-bar {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: background 0.3s ease;
        }

        .menu-toggle:hover {
            background: var(--cream-color);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .content-area {
            padding: 2rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .stat-icon.students { background: var(--primary-color); }
        .stat-icon.classes { background: var(--accent-color); }
        .stat-icon.sections { background: var(--secondary-color); }
        .stat-icon.results { background: #FF7043; }
        .stat-icon.banners { background: #9C27B0; }
        .stat-icon.notices { background: #F57C00; }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Form Styles */
        .form-container {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #E0E0E0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--accent-color);
            color: white;
        }

        .btn-danger {
            background: #F44336;
            color: white;
        }

        .btn-danger:hover {
            background: #D32F2F;
        }

        /* Data Table */
        .data-table {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            font-weight: 600;
        }

        .table-body {
            max-height: 400px;
            overflow-y: auto;
        }

        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            padding: 1rem;
            border-bottom: 1px solid #F0F0F0;
            transition: background 0.3s ease;
        }

        .table-row:hover {
            background: var(--cream-color);
        }

        .table-cell {
            display: flex;
            align-items: center;
        }

        .delete-btn {
            background: #F44336;
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .delete-btn:hover {
            background: #D32F2F;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-280px);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-area {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .table-row {
                grid-template-columns: 1fr auto;
                gap: 1rem;
            }
        }

        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .message.success {
            background: #E8F5E8;
            color: var(--dark-green);
            border: 1px solid var(--secondary-color);
        }

        .message.error {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid #F44336;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Madrasah Admin</h2>
            <p>Management Panel</p>
        </div>
        <nav class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('dashboard')">
                <span class="material-icons">dashboard</span>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="showSection('years')">
                <span class="material-icons">calendar_today</span>
                <span>Years</span>
            </div>
            <div class="menu-item" onclick="showSection('classes')">
                <span class="material-icons">school</span>
                <span>Classes</span>
            </div>
            <div class="menu-item" onclick="showSection('sections')">
                <span class="material-icons">group</span>
                <span>Sections</span>
            </div>
            <div class="menu-item" onclick="showSection('students')">
                <span class="material-icons">person</span>
                <span>Students</span>
            </div>
            <div class="menu-item" onclick="showSection('results')">
                <span class="material-icons">assessment</span>
                <span>Results</span>
            </div>
            <div class="menu-item" onclick="showSection('banners')">
                <span class="material-icons">image</span>
                <span>Banners</span>
            </div>
            <div class="menu-item" onclick="showSection('notices')">
                <span class="material-icons">announcement</span>
                <span>Notices</span>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <span class="material-icons">menu</span>
            </button>
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Total Students</div>
                            </div>
                            <div class="stat-icon students">
                                <span class="material-icons">person</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalClasses">0</div>
                                <div class="stat-label">Total Classes</div>
                            </div>
                            <div class="stat-icon classes">
                                <span class="material-icons">school</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalSections">0</div>
                                <div class="stat-label">Total Sections</div>
                            </div>
                            <div class="stat-icon sections">
                                <span class="material-icons">group</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalResults">0</div>
                                <div class="stat-label">Total Results</div>
                            </div>
                            <div class="stat-icon results">
                                <span class="material-icons">assessment</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalBanners">0</div>
                                <div class="stat-label">Total Banners</div>
                            </div>
                            <div class="stat-icon banners">
                                <span class="material-icons">image</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalNotices">0</div>
                                <div class="stat-label">Total Notices</div>
                            </div>
                            <div class="stat-icon notices">
                                <span class="material-icons">announcement</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Years Section -->
            <div id="years" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Year</h3>
                    <form id="yearForm">
                        <div class="form-group">
                            <label for="yearName">Year Name</label>
                            <input type="text" id="yearName" class="form-control" placeholder="e.g., 2024" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Year</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Years List</div>
                    <div class="table-body" id="yearsList">
                        <!-- Years will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Classes Section -->
            <div id="classes" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Class</h3>
                    <form id="classForm">
                        <div class="form-group">
                            <label for="className">Class Name</label>
                            <input type="text" id="className" class="form-control" placeholder="e.g., Class 10" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Class</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Classes List</div>
                    <div class="table-body" id="classesList">
                        <!-- Classes will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Sections Section -->
            <div id="sections" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Section</h3>
                    <form id="sectionForm">
                        <div class="form-group">
                            <label for="sectionName">Section Name</label>
                            <input type="text" id="sectionName" class="form-control" placeholder="e.g., A" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Section</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Sections List</div>
                    <div class="table-body" id="sectionsList">
                        <!-- Sections will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Students Section -->
            <div id="students" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Student</h3>
                    <form id="studentForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="studentName">Student Name</label>
                                <input type="text" id="studentName" class="form-control" placeholder="Full Name" required>
                            </div>
                            <div class="form-group">
                                <label for="studentClass">Class</label>
                                <select id="studentClass" class="form-control" required>
                                    <option value="">Select Class</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentYear">Year</label>
                                <select id="studentYear" class="form-control" required>
                                    <option value="">Select Year</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentSection">Section</label>
                                <select id="studentSection" class="form-control" required>
                                    <option value="">Select Section</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentRoll">Roll Number</label>
                                <input type="text" id="studentRoll" class="form-control" placeholder="Roll Number" required>
                            </div>
                            <div class="form-group">
                                <label for="studentUserId">User ID (Optional)</label>
                                <input type="text" id="studentUserId" class="form-control" placeholder="User ID">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Student</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Students List</div>
                    <div class="table-body" id="studentsList">
                        <!-- Students will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Result</h3>
                    <form id="resultForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="resultStudent">Student</label>
                                <select id="resultStudent" class="form-control" required>
                                    <option value="">Select Student</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resultClass">Class</label>
                                <select id="resultClass" class="form-control" required>
                                    <option value="">Select Class</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resultLink">Result Link</label>
                                <input type="url" id="resultLink" class="form-control" placeholder="PDF or Drive Link" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Result</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Results List</div>
                    <div class="table-body" id="resultsList">
                        <!-- Results will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Banners Section -->
            <div id="banners" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Banner</h3>
                    <form id="bannerForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="bannerTitle">Banner Title</label>
                                <input type="text" id="bannerTitle" class="form-control" placeholder="Banner Title" required>
                            </div>
                            <div class="form-group">
                                <label for="bannerLink">Link (Optional)</label>
                                <input type="url" id="bannerLink" class="form-control" placeholder="https://example.com">
                            </div>
                            <div class="form-group">
                                <label for="bannerImage">Image URL (Optional)</label>
                                <input type="url" id="bannerImage" class="form-control" placeholder="Image URL">
                            </div>
                            <div class="form-group">
                                <label for="bannerIcon">Icon (Optional)</label>
                                <input type="text" id="bannerIcon" class="form-control" placeholder="Material Icon Name">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Banner</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Banners List</div>
                    <div class="table-body" id="bannersList">
                        <!-- Banners will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Notices Section -->
            <div id="notices" class="section">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">Add Notice</h3>
                    <form id="noticeForm">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="noticeText">Notice Text/Title</label>
                                <textarea id="noticeText" class="form-control" rows="3" placeholder="Notice content..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="noticeUrl">URL (Optional)</label>
                                <input type="url" id="noticeUrl" class="form-control" placeholder="https://example.com">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Notice</button>
                    </form>
                </div>
                <div class="data-table">
                    <div class="table-header">Notices List</div>
                    <div class="table-body" id="noticesList">
                        <!-- Notices will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDXGVWLFDY2Jrk0Pjxz4XP0bCQVg0Iextc",
            authDomain: "queenschool-803d9.firebaseapp.com",
            databaseURL: "https://queenschool-803d9-default-rtdb.firebaseio.com",
            projectId: "queenschool-803d9",
            storageBucket: "queenschool-803d9.firebasestorage.app",
            messagingSenderId: "1078969444409",
            appId: "1:1078969444409:web:4eff0ec9ffe9b399cdc5e8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        window.currentData = {
            years: {},
            classes: {},
            sections: {},
            students: {},
            results: {},
            banners: {},
            notices: {}
        };

        // Initialize app
        window.addEventListener('load', () => {
            loadAllData();
            setupEventListeners();
        });

        // Load all data from Firebase
        function loadAllData() {
            const dataTypes = ['years', 'classes', 'sections', 'students', 'results', 'banners', 'notices'];
            
            dataTypes.forEach(dataType => {
                const dataRef = ref(database, dataType);
                onValue(dataRef, (snapshot) => {
                    const data = snapshot.val() || {};
                    window.currentData[dataType] = data;
                    updateUI(dataType, data);
                    updateStats();
                    updateDropdowns();
                });
            });
        }

        // Update UI for each data type
        function updateUI(dataType, data) {
            const listElement = document.getElementById(dataType + 'List');
            if (!listElement) return;

            listElement.innerHTML = '';
            
            Object.entries(data).forEach(([key, value]) => {
                const row = document.createElement('div');
                row.className = 'table-row';
                
                let content = '';
                switch(dataType) {
                    case 'years':
                    case 'classes':
                    case 'sections':
                        content = `
                            <div class="table-cell">${value.name || value}</div>
                            <div class="table-cell">${new Date().toLocaleDateString()}</div>
                            <div class="table-cell">
                                <button class="delete-btn" onclick="deleteItem('${dataType}', '${key}')">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        break;
                    case 'students':
                        content = `
                            <div class="table-cell">
                                <strong>${value.name}</strong><br>
                                <small>Class: ${value.class} | Section: ${value.section} | Roll: ${value.roll}</small>
                            </div>
                            <div class="table-cell">${value.year}</div>
                            <div class="table-cell">
                                <button class="delete-btn" onclick="deleteItem('${dataType}', '${key}')">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        break;
                    case 'results':
                        content = `
                            <div class="table-cell">
                                <strong>${value.studentName}</strong><br>
                                <small>Class: ${value.class}</small>
                            </div>
                            <div class="table-cell">
                                <a href="${value.link}" target="_blank" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">View Result</a>
                            </div>
                            <div class="table-cell">
                                <button class="delete-btn" onclick="deleteItem('${dataType}', '${key}')">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        break;
                    case 'banners':
                        content = `
                            <div class="table-cell">
                                <strong>${value.title}</strong><br>
                                ${value.link ? `<small><a href="${value.link}" target="_blank">View Link</a></small>` : ''}
                            </div>
                            <div class="table-cell">
                                ${value.image ? '<span class="material-icons">image</span>' : ''}
                                ${value.icon ? `<span class="material-icons">${value.icon}</span>` : ''}
                            </div>
                            <div class="table-cell">
                                <button class="delete-btn" onclick="deleteItem('${dataType}', '${key}')">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        break;
                    case 'notices':
                        content = `
                            <div class="table-cell">
                                <strong>${value.text}</strong><br>
                                ${value.url ? `<small><a href="${value.url}" target="_blank">View Link</a></small>` : ''}
                            </div>
                            <div class="table-cell">${new Date().toLocaleDateString()}</div>
                            <div class="table-cell">
                                <button class="delete-btn" onclick="deleteItem('${dataType}', '${key}')">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        break;
                }
                
                row.innerHTML = content;
                listElement.appendChild(row);
            });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalStudents').textContent = Object.keys(window.currentData.students).length;
            document.getElementById('totalClasses').textContent = Object.keys(window.currentData.classes).length;
            document.getElementById('totalSections').textContent = Object.keys(window.currentData.sections).length;
            document.getElementById('totalResults').textContent = Object.keys(window.currentData.results).length;
            document.getElementById('totalBanners').textContent = Object.keys(window.currentData.banners).length;
            document.getElementById('totalNotices').textContent = Object.keys(window.currentData.notices).length;
        }

        // Update dropdowns
        function updateDropdowns() {
            // Update class dropdowns
            const classSelects = document.querySelectorAll('#studentClass, #resultClass');
            classSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Class</option>';
                Object.entries(window.currentData.classes).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = value.name || value;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });

            // Update year dropdown
            const yearSelect = document.getElementById('studentYear');
            const currentYear = yearSelect.value;
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            Object.entries(window.currentData.years).forEach(([key, value]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value.name || value;
                yearSelect.appendChild(option);
            });
            yearSelect.value = currentYear;

            // Update section dropdown
            const sectionSelect = document.getElementById('studentSection');
            const currentSection = sectionSelect.value;
            sectionSelect.innerHTML = '<option value="">Select Section</option>';
            Object.entries(window.currentData.sections).forEach(([key, value]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value.name || value;
                sectionSelect.appendChild(option);
            });
            sectionSelect.value = currentSection;

            // Update student dropdown
            const studentSelect = document.getElementById('resultStudent');
            const currentStudent = studentSelect.value;
            studentSelect.innerHTML = '<option value="">Select Student</option>';
            Object.entries(window.currentData.students).forEach(([key, value]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${value.name} (${value.class} - ${value.section})`;
                option.dataset.studentName = value.name;
                studentSelect.appendChild(option);
            });
            studentSelect.value = currentStudent;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Year form
            document.getElementById('yearForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const yearName = document.getElementById('yearName').value.trim();
                if (yearName) {
                    const yearRef = push(ref(database, 'years'));
                    set(yearRef, { name: yearName })
                        .then(() => {
                            document.getElementById('yearForm').reset();
                            showMessage('Year added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding year', 'error'));
                }
            });

            // Class form
            document.getElementById('classForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const className = document.getElementById('className').value.trim();
                if (className) {
                    const classRef = push(ref(database, 'classes'));
                    set(classRef, { name: className })
                        .then(() => {
                            document.getElementById('classForm').reset();
                            showMessage('Class added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding class', 'error'));
                }
            });

            // Section form
            document.getElementById('sectionForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const sectionName = document.getElementById('sectionName').value.trim();
                if (sectionName) {
                    const sectionRef = push(ref(database, 'sections'));
                    set(sectionRef, { name: sectionName })
                        .then(() => {
                            document.getElementById('sectionForm').reset();
                            showMessage('Section added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding section', 'error'));
                }
            });

            // Student form
            document.getElementById('studentForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const studentData = {
                    name: document.getElementById('studentName').value.trim(),
                    class: document.getElementById('studentClass').selectedOptions[0]?.textContent || '',
                    year: document.getElementById('studentYear').selectedOptions[0]?.textContent || '',
                    section: document.getElementById('studentSection').selectedOptions[0]?.textContent || '',
                    roll: document.getElementById('studentRoll').value.trim(),
                    userId: document.getElementById('studentUserId').value.trim()
                };

                if (studentData.name && studentData.class && studentData.year && studentData.section && studentData.roll) {
                    const studentRef = push(ref(database, 'students'));
                    set(studentRef, studentData)
                        .then(() => {
                            document.getElementById('studentForm').reset();
                            showMessage('Student added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding student', 'error'));
                }
            });

            // Result form
            document.getElementById('resultForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const studentSelect = document.getElementById('resultStudent');
                const selectedOption = studentSelect.selectedOptions[0];
                
                const resultData = {
                    studentId: studentSelect.value,
                    studentName: selectedOption?.dataset.studentName || '',
                    class: document.getElementById('resultClass').selectedOptions[0]?.textContent || '',
                    link: document.getElementById('resultLink').value.trim()
                };

                if (resultData.studentId && resultData.class && resultData.link) {
                    const resultRef = push(ref(database, 'results'));
                    set(resultRef, resultData)
                        .then(() => {
                            document.getElementById('resultForm').reset();
                            showMessage('Result added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding result', 'error'));
                }
            });

            // Banner form
            document.getElementById('bannerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const bannerData = {
                    title: document.getElementById('bannerTitle').value.trim(),
                    link: document.getElementById('bannerLink').value.trim(),
                    image: document.getElementById('bannerImage').value.trim(),
                    icon: document.getElementById('bannerIcon').value.trim()
                };

                if (bannerData.title) {
                    const bannerRef = push(ref(database, 'banners'));
                    set(bannerRef, bannerData)
                        .then(() => {
                            document.getElementById('bannerForm').reset();
                            showMessage('Banner added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding banner', 'error'));
                }
            });

            // Notice form
            document.getElementById('noticeForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const noticeData = {
                    text: document.getElementById('noticeText').value.trim(),
                    url: document.getElementById('noticeUrl').value.trim(),
                    timestamp: Date.now()
                };

                if (noticeData.text) {
                    const noticeRef = push(ref(database, 'notices'));
                    set(noticeRef, noticeData)
                        .then(() => {
                            document.getElementById('noticeForm').reset();
                            showMessage('Notice added successfully!', 'success');
                        })
                        .catch(() => showMessage('Error adding notice', 'error'));
                }
            });
        }

        // Delete item function
        window.deleteItem = function(dataType, key) {
            if (confirm('Are you sure you want to delete this item?')) {
                const itemRef = ref(database, `${dataType}/${key}`);
                remove(itemRef)
                    .then(() => showMessage('Item deleted successfully!', 'success'))
                    .catch(() => showMessage('Error deleting item', 'error'));
            }
        };

        // Show message function
        function showMessage(text, type) {
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            const contentArea = document.querySelector('.content-area');
            contentArea.insertBefore(message, contentArea.firstChild);
            
            setTimeout(() => {
                message.remove();
            }, 3000);
        }
    </script>

    <script>
        // UI Functions
        let sidebarOpen = true;

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
            } else {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
            }
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                years: 'Years Management',
                classes: 'Classes Management',
                sections: 'Sections Management',
                students: 'Students Management',
                results: 'Results Management',
                banners: 'Banners Management',
                notices: 'Notices Management'
            };
            
            document.getElementById('pageTitle').textContent = titles[sectionName] || 'Dashboard';
        }

        // Mobile responsive
        function handleResize() {
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('mainContent').classList.add('expanded');
                sidebarOpen = false;
            } else {
                document.getElementById('sidebar').classList.remove('collapsed');
                document.getElementById('mainContent').classList.remove('expanded');
                sidebarOpen = true;
            }
        }

        window.addEventListener('resize', handleResize);
        window.addEventListener('load', handleResize);
    </script>
</body>
</html>
